{%- liquid
    assign options = section.settings
    assign custom_product_title = options.custom_product_title
    assign custom_single_product = options.custom_single_product
    assign custom_product_subtitle = options.custom_product_subtitle
    assign product_list = options.product_list | first
    assign product = product_list
    assign blocks = section.blocks
    assign sectionId = section.id
-%}
{% comment %} {{ product_list | json }} {% endcomment %}
<style>
.custom_product_section{
    width: 100%;
    max-width: 1440px;
    background-color: #F8FAEF;
}
.custom_product_section .inner_custom_product_section{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-start;
    padding: 40px;

    flex-direction: column;
    align-items: center;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper{
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: flex-start;
    {% comment %} max-width: 474px; {% endcomment %}
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper.mobile_only{
    display: none;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper h3{
    font-family: "Druk Web";
    font-size: 4.514vw;
    font-weight: 700;
    line-height: 60.78px;
    letter-spacing: 1px;
    margin: 0 auto;
    text-align: center;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper h3 span{
    color: #AFC42F;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper p{
    font-family: 'Lato Regular', sans-serif;
    font-size: 1.389vw;
    font-weight: 700;
    line-height: 24px;
    margin: 40px 0px 40px 0px;
    text-align: left;
    color: #4D201A;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper{
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    row-gap: 40px;
    width: 100%;
    min-width: 700px;
    margin: 30px 0px;
    display: none !important;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper .product_feature{
    width: calc(100%/ 5);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper .product_feature .feature_icon{
    width: 55px;
    height: 55px;
    margin-bottom: 10px;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper .product_feature .feature_icon img{
    width: 100%;
    height: 100%;
    object-position: center;
    object-fit: cover;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper .product_feature p{
    font-family: 'Lato Regular', sans-serif;
    font-size: 14px;
    font-weight: 900;
    line-height: 19.8px;
    margin: 10px 0px 0px 0px;
    max-width: 530px;
    text-align: left;
    color: #4D201A;
}


.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_flavour_selection{
    display: block;
    border-radius: 30px;
    border: 1px solid #212121;
    position: relative;
    width: 90%;
    margin: 20px 0px;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_flavour_selection .flavor_options{
    position: absolute;
    top: 60px;
    z-index: 9999;
    background-color: #ffffff;
    width: 100%;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px #0000000f, 0 0 4px #0000000a;
    visibility: hidden;
    opacity: 0;
    display: block;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_flavour_selection .select_flavor_value{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    padding: 13px 22px;
}

.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_flavour_selection .select_flavor_value p{
    color: #212121;
    font-size: 14px;
    font-style: normal;
    font-weight: 700;
    line-height: 12px;
    text-transform: uppercase; 
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_flavour_selection .flavor_options.show{
    visibility: visible;
    opacity: 1;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_flavour_selection .flavor_options p{
    color: rgba(0,0,0,.5);
    font-size: 14px;
    font-style: normal;
    font-weight: 700;
    line-height: 14px;
    padding: 10px 0px;
} 
.custom_product_section .inner_custom_product_section .custom_product_wrapper{
    display: flex;
    flex-direction: row;
    column-gap: 30px;
    margin-top: 30px;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper.mobile_only{
    display: flex;
    flex-direction: row;
    column-gap: 30px;
    display: none;
}

.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card{
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    {% comment %} border: 1px solid #CCCEC5; {% endcomment %}
    border-radius: 12px;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_image{
    width: 14.458vw;
    height: 19.102vw;
    max-width: 208.19px;
    max-height: 275.07px;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_image img{
    width: 100%;
    height: 100%;
    object-position: center;
    object-fit: cover;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card h4{
    font-family: 'Lato Regular', sans-serif;
    font-size: 21px;
    font-weight: 900;
    line-height: 26.4px;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product{
    display: flex;
    flex-direction: column;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product .one_time_product,.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product .subscription_product{
    display: flex;
    flex-direction: column;
    min-width: 360px;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product .one_time_product label,.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product .subscription_product label{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
}
.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product .one_time_product label .radio_text,.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product .subscription_product label .radio_text{
    display: flex;
    flex-direction: row;
    align-items: baseline;
}
{% comment %} .custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card:nth-child(1),.custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card:nth-child(2){
    display: none;
} {% endcomment %}
.custom_product_section .btn--solid{
    background-color: #AFC42F;
    color: #121212;
    padding: 10px 20px!important;
    border-radius: 100px;
    letter-spacing: 0px;
    text-align: center;
    max-width: calc(100% - 40px);
    margin-left: 24px;
    margin-bottom: 20px;
}
.custom_product_section .inner_custom_product_section .text_icon_wrapper.mobile_only .product_feature_wrapper.mobile_only{
    display: none;
}
@media screen and (min-width: 1441px){
    .custom_product_section{
        {% comment %} margin: 0 auto; {% endcomment %}
        max-width: unset;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper h3{
        font-size: 66px;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper p{
        line-height: 1.6656vw;
    }
    .custom_product_section .inner_custom_product_section{
        max-width: 1440px;
        margin: 0 auto;
    }
}
@media screen and (min-width: 820px) and (max-width: 1220px) {
    .custom_product_section .inner_custom_product_section{
        flex-direction: column;
        align-items: center;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper{
        max-width: unset;
        margin: 0 auto;
        align-items: center;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper{
        margin-bottom: 30px;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper .product_feature{
        width: calc(100%/ 5);
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper p{
        text-align: center;
    }
    .custom_product_section .inner_custom_product_section .custom_product_wrapper{
        flex-wrap: wrap;
        justify-content: center;
    }
    .founded_by .inner_founded_by .kevin_image_desktop {
        position: absolute;
        width: 53.611vw;
        max-width: 752px;
        height: 39.403vw !important;
        max-height: 695px !important;
        bottom: 0px;
        left: 220px !important;
    }
}
@media screen and (max-width: 820px) {
    .custom_product_section .inner_custom_product_section .custom_product_wrapper{
        display: none;
    }
    .custom_product_section .inner_custom_product_section .custom_product_wrapper.mobile_only{
        display: flex;
        flex-direction: column;
    }
    .custom_product_section .inner_custom_product_section{
        padding: 20px;
        align-items: center;

    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper{
        max-width: unset;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper.mobile_only{
        display: flex;
    }
    .custom_product_section .inner_custom_product_section{
        flex-direction: column;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper{
        max-width: 820px;
        overflow-y: scroll;
        flex-wrap: nowrap;
        min-width: unset;
    }

    .custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper::-webkit-scrollbar{
        display: none;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper .product_feature{
        width: calc(100%/ 3);
        min-width: 32%;
        display: block;
    }
    .custom_product_section .inner_custom_product_section .custom_product_wrapper{
        flex-direction: column;
        row-gap: 20px;
        margin-top: 30px;
        width: 100%;
    }
    .custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card{
        width: 100%;
        max-width: 400px;
        margin: 0 auto;
    }
    .custom_product_section .inner_custom_product_section .custom_product_wrapper.mobile_only .product_card{
        display: none;
    }
    .custom_product_section .inner_custom_product_section .custom_product_wrapper.mobile_only .product_card.active{
        display: flex;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper h3{
        font-family: "Druk Web";
        font-size: 47px;
        font-weight: 700;
        line-height: 46.75px;
        letter-spacing: 1px;
        max-width: unset;
        text-align: center;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper p{
        font-family: 'Lato Regular', sans-serif;
        font-size: 17px;
        font-weight: 700;
        line-height: 21.6px;
        margin: 20px 0px 20px 0px;
        max-width: 530px;
        text-align: center;
        color: #4D201A;

    }
    .custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product .one_time_product, .custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product .subscription_product{
        min-width: unset;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper{
        display: none;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper.mobile_only .product_feature_wrapper.mobile_only{
        display: flex;
        margin: 20px;
    }
    .custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper .product_feature .feature_icon{
        width: 65px;
        height: 65px;

    }
}

@media screen and (max-width: 768px) {
    .custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper{
        max-width: 768px;
        overflow-y: scroll;
        flex-wrap: nowrap;
    }
}

@media screen and (max-width: 450px) {
    .custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_image{
        width: 184px;
        height: 246px;
    }
}

@media screen and (max-width: 450px) {
    .custom_product_section .inner_custom_product_section .text_icon_wrapper .product_feature_wrapper{
        max-width: 335px;
        width: 365px;
        overflow-y: scroll;
        flex-wrap: nowrap;
    }
    .custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .choose_product{
        width: 100%;
    }
    .custom_product_section .inner_custom_product_section .custom_product_wrapper .product_card .product_image{
        width: 184px;
        height: 246px;
    }
}
</style>

<div class="custom_product_section">
    <div class="inner_custom_product_section">
        <div class="text_icon_wrapper">
            {% if custom_product_title != blank %}
                <h3>{{ custom_product_title }}</h3>
            {% endif %}
            {% if custom_product_subtitle != blank %}
                <p>{{ custom_product_subtitle }}</p>
            {% endif %}
            <div class="product_feature_wrapper">
                {% for block in blocks %}
                    <div class="product_feature">
                        <div class="feature_icon">
                            <img src="{{ block.settings.image_content | img_url: 'master' }}">
                        </div>
                        <p>{{ block.settings.text_content }}</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        {% comment %} <div class="product_flavour_selection">
            <div class="select_flavor_value">
                <p>Dark Cacao</p>
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="20" viewBox="0 0 23 20" fill="none">
                    <path d="M6.32031 7.5L11.8159 12.5L17.3116 7.5" stroke="#212121" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="flavor_options">
                {% for product in product_list %}
                    <p variantId="{{ product.variants[0].id }}" >{{ product.metafields.custom.flavor_name }}</p>
                {% endfor %}
            </div>
        </div> {% endcomment %}
        
        <div class="custom_product_wrapper desktop_only">
            {% comment %} {%  assign selected_product = product_list %} {% endcomment %}
            {% comment %} {{ selected_product.variants | json }} {% endcomment %}
            {%  for i in (1..3) %}    
                    {% comment %} {{ variant.title }} {% endcomment %}
                    {% assign index = forloop.index | minus: 1 %}
                    <div class="product_card">
                        <div class="product_image">
                            {% comment %} <img src="{{  variant.featured_image | img_url: '305x'  }}"> {% endcomment %}
                            <img src="{{  product.variants[index].metafields.custom.variant_thumbnail_image.value | img_url: '1440x'  }}">

                        </div>
                        {% comment %} <h4>{{ variant.title }}</h4> {% endcomment %}
                        <h4>{{ product.variants[index].title }}</h4>
                        
                        <div class="choose_product">

                            {% render 'custom-homepage-subcription-widget', product: product, section: section, block: block, sectionId: sectionId, index:index  %}
                            {% render 'new-product-quantity-block', product: product, section: section, block: block, sectionId: sectionId, index:index %}
                            {% render 'new-product-form-block', product: product, section: section, block: block, sectionId: sectionId, index:index %}
                            
                        </div>
                        {% comment %} <div class="quantitly_box">
                            
                        </div> {% endcomment %}
                    </div>
                

            {%  endfor %}
        </div>

        <div class="custom_product_wrapper mobile_only">
            {% comment %} {%  assign selected_product = product_list %} {% endcomment %}
            {% comment %} {{ selected_product.variants | json }} {% endcomment %}

            {%  for i in (1..3) %}
                    {% assign index = forloop.index0 %}
                    {% assign index_m = forloop.index |  minus: 1 %}
                    {% comment %} {{ variant.title }} {% endcomment %}
                    <div class="product_card {{ product.variants[index_m].title }}{% if product.variants[index_m].title=="Chocolate" %} active{% endif %}" flavour="{{ product.variants[index_m].title }}">
                        <div class="product_image"> 
                            {% comment %} <img src="{{  variant.featured_image | img_url: '305x'  }}"> {% endcomment %}
                            <img src="{{  product.variants[index_m].metafields.custom.variant_thumbnail_image.value | img_url: '1440x'  }}">

                        </div>
                        {% comment %} <h4>{{ variant.title }}</h4> {% endcomment %}
                        <h4>{{ product.variants[index_m].title }}</h4>
                        
                        <div class="product_flavour_selection">
                            <div class="select_flavor_value">
                                <p>{{ product.variants[index_m].title }}</p>
                                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="20" viewBox="0 0 23 20" fill="none">
                                    <path d="M6.32031 7.5L11.8159 12.5L17.3116 7.5" stroke="#212121" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="flavor_options">
                                {% for i in (1..3) %}
                                    {% assign ind = forloop.index |  minus: 1 %}
                                    <p variantId="{{ product.variants[ind].id }}" >{{ product.variants[ind].title }}</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="choose_product">

                            {% render 'custom-homepage-subcription-widget', product: product, section: section, block: block, sectionId: sectionId, isMobile:true, index: index_m %}
                            {% render 'new-product-quantity-block', product: product, section: section, block: block, sectionId: sectionId, index: index_m %}
                            {% render 'new-product-form-block', product: product, section: section, block: block, sectionId: sectionId, index: index_m %}
                            
                        </div>
                        {% comment %} <div class="quantitly_box">
                            
                        </div> {% endcomment %}
                    </div>
                

            {%  endfor %}
        </div>

        {% comment %} <div class="custom_product_wrapper mobile_only">
           {% assign selected_product = custom_single_product %}
           {% assign product = selected_product.variants[1] %}

            <div class="product_card">
                <div class="product_image">
                    <img src="{{  selected_product.variants[1].metafields.custom.variant_thumbnail_image.value| img_url: '1440x'  }}">

                </div>
                <h4>{{ selected_product.variants[1].title}}</h4>
                
                <div class="choose_product">

                    {% render 'custom-homepage-subcription-widget', product: product, section: section, block: block, sectionId: sectionId %}
                    {% render 'new-product-quantity-block', product: product, section: section, block: block, sectionId: sectionId %}
                    <div class="add_t0_cart_custom_product">
                        <span>Add To cart</span>
                    </div>
                    
                </div>
            </div>

        </div> {% endcomment %}
        <div class="text_icon_wrapper mobile_only">
            <div class="product_feature_wrapper mobile_only">
                {% for block in blocks %}
                    <div class="product_feature">
                        <div class="feature_icon">
                            <img src="{{ block.settings.image_content | img_url: 'master' }}">
                        </div>
                        <p>{{ block.settings.text_content }}</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    $('.select_flavor_value').on('click',function(){
        $('.flavor_options').toggleClass('show');
    })
    $('.flavor_options p').on('click',function(){
        let content = $(this).text();
        $('.select_flavor_value p').text(content);
        let product_type = $(this).closest('.product_card').find('.purchase_type_block > input[type="radio"]:checked').val();
        let selling_plan = $(this).closest('.product_card').find('.available_frequency input[type="radio"]:checked').val();
        let product_cards = $(this).closest('.custom_product_wrapper').children('.product_card');
        {% comment %} $('.custom_product_section .inner_custom_product_section .custom_product_wrapper.mobile_only .product_card').removeClass('active'); {% endcomment %}
        let allElement = $('.custom_product_section .inner_custom_product_section .custom_product_wrapper.mobile_only .product_card');
        allElement.each(function(k){
            let tempattr = $(this).attr('flavour');
            console.log("attr",tempattr);
            let current_product_type = $(this).find('.purchase_type_block > input[type="radio"]');
            console.log("product_type",product_type);
            if(product_type=="selling_plan"){
                console.log("working...",$(this).find('.selected_frequency'));
                $(this).find('.selected_frequency').removeClass('disable');
            }
            else{
                $(this).find('.selected_frequency').addClass('disable');
            }
            current_product_type.each(function(item){
                if($(this).val()==product_type){
                    $(this).prop('checked',true);
                }
            })
            $(this).find('.available_frequency li').each(function(key){
                let current_inputs = $(this).find('input[type="radio"]');
                current_inputs.each(function(i){
                    if($(this).val()==selling_plan){
                        $(this).prop('checked',true);
                        $(this).parent().children('label').removeClass('active');
                        $(this).children('label').addClass('active');
                        const days = $(this).siblings('span:last-child').text();
                        $(this).closest('.delivery_frequency_box').find('.selected span:last-child').text(days);
                    }
                })
                {% comment %} console.log("selling_plan",selling_plan,current_selling_plan);
                if(selling_plan==current_selling_plan){
                    $(this).children('input[type="radio"]').prop('checked',true);
                    $(this).parent().children('label').removeClass('active');
                    $(this).children('label').addClass('active');
                } {% endcomment %}
            })
            if(tempattr==content){
                $(this).removeClass('active');
                $(this).addClass('active');
                $(this).find('.onetime_box.purchase_type_box').trigger( "click" );
            }
            else{
                $(this).removeClass('active');
            }
        })
        {% comment %} targetElement.addClass('active'); {% endcomment %}
        $('.flavor_options').toggleClass('show');

    })
    if(window.innerWidth<=820){
        $('.custom_product_wrapper.desktop_only').remove();
    }
    else{
        $('.custom_product_wrapper.mobile_only').remove();
    } 
</script>

{% schema %}
  
{
  "name": "Custom product section",
  "settings": [
    {
        "type": "text",
        "id": "custom_product_title",
        "label": "t:sections.custom_product.custom_product_title"
    },
    {
        "type": "text",
        "id": "custom_product_subtitle",
        "label": "t:sections.custom_product.custom_product_subtitle"
    },
    {
        "type": "product",
        "id": "custom_single_product",
        "label": "Choose a single product"
    },
    {
        "type": "product_list",
        "id": "product_list",
        "label": "t:sections.custom_product.product_list"
    }

  ],
  "blocks": [
      {
        "type": "rich_text",
        "name": "t:sections.custom_product.blocks.image_text.name",
        "settings": [
            {
                "type": "image_picker",
                "id": "image_content",
                "label":"t:sections.custom_product.blocks.image_text.image_content.label"
            },
            {
                "type": "text",
                "id": "text_content",
                "label":"t:sections.custom_product.blocks.image_text.text_content.label"
            }
    
        ]
      }

  ],
  "presets": [
    {
      "name": "Custom product section"
    }
  ]
}

{% endschema %}